<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" >
  <head>
        <title>Orca XML File Formats</title>
    <link rel="stylesheet" href="generic2.css" type="text/css" />
  </head>
    <body>


<!-- Do not edit or remove this line: it causes add_sidebar.pl to add the menu -->


      <p>&nbsp;</p>
<h1>Orca XML File Formats</h1>

      <p>(Not yet converted to Orca2)</p>

      <p>This page describes the use of XML file for component configuration.</p>

      <h2>Contents</h2>

      <ul>
       <li><a href="#fileformat">XML File Formats</a></li>
        <ul>
        <li><a href="#configfile">Orca Component Configuration File Format</a></li>
        <li><a href="#deffile">Orca Component Definition File Format</a></li>
        </ul>
        <li><a href="#namingconventions">Naming Conventions</a></li>
        <li><a href="#locations">Locations of Orca Schema Files</a></li>
        <li><a href="#validate">Validating XML Files</a></li>
      </ul>

<h2><a name="fileformat">XML File Formats</h2>

      <p>Orca components have three kinds of xml files associated with
      them.  Most users will only care about one, <a
      href="#configfile">the XML configuration file</a>.  This file is used
      to set parameters and configure connections. The other two are the XML schema file
      which defines what a valid config file should look like and the component definition file
      which allows the use of automated system composition tools. Both are optional and are
      described below.</a>

      <h3><a name="configfile">Orca Component Configuration File Format</h3>

      <p>Configuration files are used to start up Orca
      components. They are written in XML. To ensure that the files
      have the right structure, they are validated using XML
      schemas. Schemas allow one to formally define a dialect of
      XML. Essentially, we are defining a language which Orca
      components understand.</p>

      <p>A large part of the configuration file has the same structure
      for all components. So the schema to define it has to be written
      only once. One option a component user has is to validate the
      configuration file only against the generic schema. We'll look at
      this simpler option first, and then show how to write a schema
      for your particular component.</p>

      <h4>Option 1: Partial Validation</H4>

      <p>First, suppose no special schema file exists for this
      component. Instead we use a generic schema file supplied with
      Orca. It allows an arbitrary list of parameters and tag names. As an
      example, consider a simple component with one server, one
      client, and two configuration parameters. It uses the Naming Service for
      connections. This is <strong>mycomponent.xml</strong> file.</p>

      <TABLE CLASS="ex" cellSpacing=0 width="100%" border=1><TBODY><TR><TD><PRE>
&lt;?xml version="1.0"?&gt;
&lt;!-- component configuration file --&gt;
&lt;component xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="http://orca-robotics.sf.net/component"
  xsi:schemaLocation="http://orca-robotics.sf.net/component
    /usr/local/share/orca/schemas/<SPAN CLASS="emph">generic.xsd</span>"&gt;

  &lt;server tag="knowledge"&gt;
      &lt;serverNameService nsPlatform="local" nsName="myKnowledge"/&gt;
      &lt;serverAddressCrud channel="5"/&gt;
  &lt;/server&gt;

  &lt;client tag="mistakes"&gt;
      &lt;clientNameService nsPlatform="local" nsName="yourMistakes"/&gt;
  &lt;/client&gt;

  &lt;parameters learnRate="500.0" forgetFactor="0.0"/&gt;
&lt;/component&gt;
</PRE></TD></TR></TBODY></TABLE>

      <p>That's all that's needed to write a component configuration
      file by hand.  A sample config file like this one is written by the component
      designer, stored in the component src directory and installed into a special place
      during installation (we'll get back to it later). A component integrator (3rd
      party) modifies this sample to suit the needs of the system. The syntax of
      server/client configuration is validated. Component parameters are not.</p>

      <p>Note that server/client tags cannot be modified in the config file. These must
      match the text strings in the source code. We can enforce the correct tag usage with
      schemas described next.</p>


      <h4><a name="schema">Option 2: Full Validation</H4>

      <p>Now write a special schema file for this component. This is
      <strong>mycomponent.xsd</strong> file. Ideally, it's written by
      the component designer.</p>

<TABLE CLASS="ex" cellSpacing=0 width="100%" border=1><TBODY><TR><TD><PRE>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!-- This is an XML schema definitions for the
        sample MyComponent component --&gt;
  &lt;xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
    elementFormDefault="qualified"
    xmlns="http://orca-robotics.sf.net/component"
    targetNamespace="http://orca-robotics.sf.net/component"&gt;

    &lt;xs:redefine schemaLocation="component.xsd"&gt;
      &lt;!-- redefinition of type Parameters --&gt;
      &lt;xs:complexType name="Parameters"&gt;
        &lt;xs:complexContent&gt;
          &lt;xs:extension base="Parameters"&gt;
            <SPAN CLASS="emph">&lt;xs:attribute name="learnRate"
                            use="required"
                            type="xs:integer"/&gt;
              &lt;xs:attribute name="forgetFactor"
                            use="optional"
                            type="xs:float"/&gt;</SPAN>
          &lt;/xs:extension&gt;
        &lt;/xs:complexContent&gt;
      &lt;/xs:complexType&gt;

      &lt;!-- redefinition of type Tag --&gt;
      &lt;xs:simpleType name="Tag"&gt;
        &lt;xs:restriction base="Tag"&gt;
          <SPAN CLASS="emph">&lt;xs:enumeration value="knowledge"/&gt;
            &lt;xs:enumeration value="mistakes"/&gt;</SPAN>
        &lt;/xs:restriction&gt;
      &lt;/xs:simpleType&gt;
    &lt;/xs:redefine&gt;
  &lt;/xs:schema&gt;
</PRE></TD></TR></TBODY></TABLE>

  <p>The lines specific to this component are highlighted. First the generic definition of XML
  element "Parameters" is "extended" to include two attributes: "learnRate" and "forgetFactor".
  Now let's use this schema to validate <strong>mycomponent.xml</strong> (the only difference is in line
  4: generic.xsd is replaced with mycomponent.xsd).</p>

<TABLE CLASS="ex" cellSpacing=0 width="100%" border=1><TBODY><TR><TD><PRE>
&lt;?xml version="1.0"?&gt;
&lt;!-- This is an XML configuration file for an Orca component. See http://orca-robotics.sf.net --&gt;
&lt;component xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="http://orca-robotics.sf.net/component"
  xsi:schemaLocation="http://orca-robotics.sf.net/component
    /usr/local/share/orca/schemas/<SPAN CLASS="emph">mycomponent.xsd</span>"&gt;

  &lt;server tag="knowledge"&gt;
      &lt;serverNameService nsPlatform="local" nsName="myKnowledge"/&gt;
      &lt;serverAddressCrud channel="5"/&gt;
  &lt;/server&gt;

  &lt;client tag="mistakes"&gt;
      &lt;clientNameService nsPlatform="local" nsName="yourMistakes"/&gt;
  &lt;/client&gt;

  &lt;parameters learnRate="500" forgetFactor="0.0"/&gt;
&lt;/component&gt;
</PRE></TD></TR></TBODY></TABLE>

      <p>Now the component parameters can be validated as well. 'learnRate' must
      be a integer and it is required. 'forgetFactor' is a float
      but it is optional (meaning there's a sensible default in the
      code). Many other types like "xs:string" are defined (see any book on XML Schemas).
      Tag values are also checked, e.g. 'tag="mistake"' would not be accepted (should be
      "mistakes").</p>


      <H3><a name="deffile">Orca Component Definition File Format</H3>

      <p>Right now, the main reason to write this file is to provide
      enough information for automated generation of config files
      (above) using some GUI tool. This file must be written only once
      per component, by the component developer. An example is
      below. Note that it also uses the specific schema file
      mycompnent.xsd. This is <strong>mycomponent.ocd</strong>
      file.</p>

<TABLE CLASS="ex" cellSpacing=0 width="100%" border=1><TBODY><TR><TD><PRE>
&lt;?xml version="1.0"?&gt;
&lt;!-- component definition file --&gt;
&lt;o:componentDefinition name="LaserServer" filename="laserserver"
                          info="Laser server using Player device driver"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		       xmlns="http://orca-robotics.sf.net/component"
               xmlns:o="http://orca-robotics.sf.net/definition"
               xsi:schemaLocation="http://orca-robotics.sf.net/component
                 /usr/local/share/orca/schemas/<SPAN CLASS="emph">mycomponent.xsd</SPAN>
                 http://orca-robotics.sf.net/definition
                 /usr/local/share/orca/schemas/definition.xsd"&gt;
	&lt;!-- servers --&gt;
	&lt;o:serverDefinition tag="knowledge"
                          <SPAN CLASS="emph">object="FoodForThought"
                            pattern="ServerPush"</SPAN>
                            maxConnections="1"&gt;
            &lt;serverNameService nsPlatform="local" nsName="myKnowledge"/&gt;<SPAN CLASS="emph">
            &lt;serverTraderService tsType="knowledge"/&gt;</SPAN>
	&lt;/o:serverDefinition&gt;

	&lt;!-- clients --&gt;
	&lt;o:clientDefinition tag="mistakes"
                          <SPAN CLASS="emph">object="PainfulMistakeSequence"
                            pattern="ServerPush"
                            necessary="true"</span>&gt;
            &lt;clientNameService nsPlatform="local" nsName="unknown"/&gt;<SPAN CLASS="emph">
            &lt;clientTraderService tsType="experiences"/&gt;</SPAN>
	&lt;/o:clientDefinition&gt;

	&lt;!-- default parameters --&gt;
	&lt;parameters learnRate="2.0" forgetFactor="0.0"/&gt;
&lt;/o:componentDefinition&gt;
</PRE></TD></TR></TBODY></TABLE>

      <p>The listing highlights the extra information present in the
      definition file. Trader information may be provided here even if
      the configuration file does not use it. Also settings for
      multiple transport mechanisms.


      <H3><a name="namingconventions">Naming Conventions</H3>

      <p>Just like in writing source code, it helps to stick to some naming conventions.</p>

      <UL>
        <LI>Filenames: all low case with no spaces, e.g. mycomponent.xml</LI>

        <LI>Names of components, objects, and patterns: like classes,
        e.g. Point2D, ServerPush. A special case are names with
        abbreviations in them, e.g. SlamLocalizer,
        VfhObstacleAvoidance, etc. (rather than VFHObstacleAvoidance,
        SLAMLocalizer, etc).</LI>

        <LI>Everything else: like variables, e.g. mySpecialAttribute.

        <LI>Namespaces: they look like URL's, but only as a convenient
        way to assure uniqueness. So we use the orca SF web site. The
        schemas can actually be retrieved from the web by supplying a
        valid URL in the "schemaLocation" attributed. Not very useful
        for our robots, since all of them will get the schemas as part
        of a distribution.</LI>
      </UL>


      <H3><a name="locations">Locations of Orca Schema Files</h3>

      <p>All component-specific files are distributed in the individual component source directories.</p>

<TABLE CLASS="ex" cellSpacing=0 width="100%" border=1><TBODY><TR><TD><PRE>
$ ls orca-components/src/components/mycomponent/
mycomponent.xml
mycomponent.xsd
mycomponent.ocd
...
</PRE></TD></TR></TBODY></TABLE>

      <p>On installation, all these files are installed into known places:</p>

<TABLE CLASS="ex" cellSpacing=0 width="100%" border=1><TBODY><TR><TD><PRE>
$ ls /usr/local/share/orca/configs/
mycomponent.xml
yourcomponent.xml
$ ls /usr/local/share/orca/schemas/
mycomponent.xsd
yourcomponent.xsd
$ ls /usr/local/share/orca/defs/
mycomponent.ocd
yourcomponent.ocd
</PRE></TD></TR></TBODY></TABLE>



      <h3><a name="validate">Validating XML Files</h3>
      <p>Offline (dev-time) and online (run-time). Offline first:</p>

      <OL>
        <LI>By inspection... Just kidding.</LI>
	<li>With a special utility supplied with Orca. Just tell it which XML file to validate.
<TABLE CLASS="ex" cellSpacing=0 width="100%" border=1><TBODY><TR><TD><PRE>
$ orcaxmlvalidator mycomponent.xml
</PRE></TD></TR></TBODY></TABLE>
	It prints out warnings and errors which are reasonably helpful. If none were printed it's all good.
	If you get a lot of errors, make sure that one of the sample config files checks out ok, otherwise
	something may be wrong with your installation.
<TABLE CLASS="ex" cellSpacing=0 width="100%" border=1><TBODY><TR><TD><PRE>
$ orcaxmlvalidator /usr/local/share/orca/configs/playerlaser.xml
XML validation is ON
Name space parsing is ON
Schema validation is ON

Finished parsing playerlaser.xml: 18 ms
</PRE></TD></TR></TBODY></TABLE>
	There is also a script file which allows to validate all files in a directory.
<TABLE CLASS="ex" cellSpacing=0 width="100%" border=1><TBODY><TR><TD><PRE>
$ ./orca-components/src/util/validate_all.sh myxmldir xml
</PRE></TD></TR></TBODY></TABLE>
	</li>
        <LI>In a special XML development environment, e.g. Stylus Studio.</LI>
        <LI>On the web, e.g. http://tools.decisionsoft.com/cgi-bin/schemaValidate.cgi</LI>
      </OL>

      <p>At run time, all components use an XML parser capable of validating against schemas.
      See example code on the use of XmlDoc class.</p>

<!-- Do not edit or remove this line: it causes add_sidebar.pl to add the footer -->

</body>
</html>
